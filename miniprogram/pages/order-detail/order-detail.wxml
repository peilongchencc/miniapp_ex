<!--order-detail.wxml-->
<view class="detail-page">
  <navigation-bar
    title="è®¢å•è¯¦æƒ…"
    back="{{true}}"
    color="white"
    background="linear-gradient(135deg, rgba(130, 180, 170, 0.85) 0%, rgba(100, 160, 150, 0.95) 100%)"
    bindback="goBack"
  ></navigation-bar>

  <view class="detail-body" wx:if="{{order}}">
    <!-- è®¢å•çŠ¶æ€å¤´éƒ¨ -->
    <view class="status-header status-bg-{{order.status}}">
      <view class="status-main">
        <text class="status-icon">{{statusIconMap[order.status]}}</text>
        <text class="status-text">{{order.statusText}}</text>
      </view>
      <text class="status-desc" wx:if="{{order.status === 'pending'}}">å•†å®¶æ­£åœ¨ç¡®è®¤æ‚¨çš„è®¢å•</text>
      <text class="status-desc" wx:elif="{{order.status === 'confirmed'}}">è®¢å•å·²ç¡®è®¤ï¼Œç­‰å¾…å‘è´§</text>
      <text class="status-desc" wx:elif="{{order.status === 'shipped'}}">å•†å“æ­£åœ¨é…é€ä¸­</text>
      <text class="status-desc" wx:else>è®¢å•å·²å®Œæˆï¼Œæ„Ÿè°¢æ‚¨çš„è´­ä¹°</text>
    </view>

    <!-- è®¢å•è¿›åº¦ -->
    <view class="progress-card">
      <view class="progress-steps">
        <view 
          class="step-item {{item.done ? 'done' : ''}} {{item.active ? 'active' : ''}}" 
          wx:for="{{order.statusSteps}}" 
          wx:key="status"
        >
          <view class="step-dot"></view>
          <view class="step-line" wx:if="{{index < order.statusSteps.length - 1}}"></view>
          <view class="step-content">
            <text class="step-label">{{item.label}}</text>
            <text class="step-time" wx:if="{{item.time}}">{{item.time}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç‰©æµä¿¡æ¯ -->
    <view class="logistics-card" wx:if="{{order.logistics}}">
      <view class="card-header">
        <text class="card-title">ç‰©æµä¿¡æ¯</text>
        <view class="copy-btn" bindtap="copyTrackingNo">å¤åˆ¶å•å·</view>
      </view>
      <view class="logistics-info">
        <view class="logistics-row">
          <text class="logistics-label">ç‰©æµå…¬å¸</text>
          <text class="logistics-value">{{order.logistics.company}}</text>
        </view>
        <view class="logistics-row">
          <text class="logistics-label">è¿å•å·</text>
          <text class="logistics-value">{{order.logistics.trackingNo}}</text>
        </view>
        <view class="logistics-latest" wx:if="{{order.logistics.latestInfo}}">
          <text class="latest-icon">ğŸ“</text>
          <text class="latest-text">{{order.logistics.latestInfo}}</text>
        </view>
      </view>
    </view>

    <!-- æ”¶è´§ä¿¡æ¯ -->
    <view class="address-card">
      <view class="card-header">
        <text class="card-title">æ”¶è´§ä¿¡æ¯</text>
      </view>
      <view class="address-content">
        <view class="receiver-info">
          <text class="receiver-name">{{order.receiver.name}}</text>
          <text class="receiver-phone" bindtap="callPhone">{{order.receiver.phone}}</text>
        </view>
        <view class="receiver-address">
          <text class="address-icon">ğŸ“</text>
          <text class="address-text">{{order.receiver.address}}</text>
        </view>
      </view>
    </view>

    <!-- å•†å“åˆ—è¡¨ -->
    <view class="items-card">
      <view class="card-header">
        <text class="card-title">å•†å“æ¸…å•</text>
        <text class="items-count">å…±{{order.items.length}}ä»¶</text>
      </view>
      <view class="items-list">
        <view class="item-row" wx:for="{{order.items}}" wx:key="id">
          <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
          <view class="item-info">
            <text class="item-name">{{item.name}}</text>
            <text class="item-spec" wx:if="{{item.spec}}">è§„æ ¼ï¼š{{item.spec}}</text>
            <view class="item-price-row">
              <!-- ä»·æ ¼æ˜¾ç¤ºï¼šå½“å‰ä»· + åˆ’çº¿ä»· -->
              <view class="price-wrap">
                <text class="item-price">Â¥{{item.userPrice || item.basePrice}}</text>
                <text class="item-original-price" wx:if="{{item.userPrice && item.userPrice < item.basePrice}}">Â¥{{item.basePrice}}</text>
              </view>
              <text class="item-quantity">x{{item.quantity}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ä»·æ ¼æ˜ç»† -->
    <view class="pricing-card" wx:if="{{order.pricing}}">
      <view class="card-header">
        <text class="card-title">ä»·æ ¼æ˜ç»†</text>
      </view>
      <view class="pricing-list">
        <view class="pricing-row">
          <text class="pricing-label">å•†å“å°è®¡</text>
          <text class="pricing-value">Â¥{{order.pricing.subtotal}}</text>
        </view>
        <view class="pricing-row">
          <text class="pricing-label">è¿è´¹</text>
          <text class="pricing-value {{order.pricing.freight === 0 ? 'free' : ''}}">{{order.pricing.freight === 0 ? 'å…è¿è´¹' : 'Â¥' + order.pricing.freight}}</text>
        </view>
        <view class="pricing-row" wx:if="{{order.pricing.discount > 0}}">
          <text class="pricing-label">ä¼˜æƒ </text>
          <text class="pricing-value discount">-Â¥{{order.pricing.discount}}</text>
        </view>
        <view class="pricing-total">
          <text class="total-label">å®ä»˜é‡‘é¢</text>
          <text class="total-value">Â¥{{order.pricing.total}}</text>
        </view>
      </view>
    </view>



    <!-- è®¢å•ä¿¡æ¯ -->
    <view class="order-info-card">
      <view class="card-header">
        <text class="card-title">è®¢å•ä¿¡æ¯</text>
      </view>
      <view class="order-info-list">
        <view class="info-row">
          <text class="info-label">è®¢å•ç¼–å·</text>
          <view class="info-value-wrap">
            <text class="info-value">{{order.id}}</text>
            <view class="copy-btn small" bindtap="copyOrderId">å¤åˆ¶</view>
          </view>
        </view>
        <view class="info-row">
          <text class="info-label">ä¸‹å•æ—¶é—´</text>
          <text class="info-value">{{order.createTime}}</text>
        </view>
        <view class="info-row" wx:if="{{order.remark}}">
          <text class="info-label">è®¢å•å¤‡æ³¨</text>
          <text class="info-value remark">{{order.remark}}</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œ -->
    <view class="bottom-actions">
      <view class="action-left">
        <view class="action-btn secondary" bindtap="contactService">è”ç³»å®¢æœ</view>
        <view 
          class="action-btn secondary" 
          wx:if="{{order.status === 'pending'}}" 
          bindtap="cancelOrder"
        >å–æ¶ˆè®¢å•</view>
      </view>
      <view class="action-right">
        <view 
          class="action-btn primary" 
          wx:if="{{order.status === 'shipped'}}" 
          bindtap="confirmReceive"
        >ç¡®è®¤æ”¶è´§</view>
        <view class="action-btn primary" bindtap="handleReorder">å†æ¬¡è´­ä¹°</view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <text class="empty-text">è®¢å•ä¸å­˜åœ¨</text>
    <view class="empty-btn" bindtap="goBack">è¿”å›</view>
  </view>
</view>
