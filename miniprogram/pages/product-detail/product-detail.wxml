<!--product-detail.wxml-->
<view class="detail-page">
  <navigation-bar
    title="å•†å“è¯¦æƒ…"
    back="{{true}}"
    color="white"
    background="linear-gradient(135deg, rgba(130, 180, 170, 0.85) 0%, rgba(100, 160, 150, 0.95) 100%)"
    bindback="goBack"
  />

  <scroll-view class="detail-body" scroll-y wx:if="{{product}}">
    <!-- å•†å“å›¾ç‰‡è½®æ’­ -->
    <view class="swiper-section">
      <swiper 
        class="product-swiper"
        indicator-dots="{{false}}"
        autoplay="{{true}}"
        interval="{{4000}}"
        circular="{{true}}"
        bindchange="onSwiperChange"
      >
        <swiper-item wx:for="{{product.images}}" wx:key="index">
          <image 
            class="swiper-image" 
            src="{{item}}" 
            mode="aspectFill"
            data-index="{{index}}"
            bindtap="previewImage"
          />
        </swiper-item>
      </swiper>
      <view class="swiper-indicator">
        <text class="indicator-text">{{currentImageIndex + 1}}/{{product.images.length}}</text>
      </view>
    </view>

    <!-- å•†å“åŸºæœ¬ä¿¡æ¯ -->
    <view class="product-info-section">
      <!-- ä»·æ ¼åŒºåŸŸï¼šå½“å‰ä»· + åˆ’çº¿ä»· -->
      <view class="price-row">
        <view class="price-area">
          <text class="price-symbol">Â¥</text>
          <text class="price-value">{{product.userPrice ? product.userPrice : product.basePrice}}</text>
          <text wx:if="{{product.userPrice}}" class="original-price">Â¥{{product.basePrice}}</text>
        </view>
        <view class="sold-info">
          <text class="sold-text">å·²å”® {{product.soldCount}} ä»¶</text>
        </view>
      </view>
      
      <!-- å•†å“åç§° -->
      <view class="product-name-row">
        <text class="product-name">{{product.name}}</text>
      </view>
      
      <!-- å•†å“ç®€ä»‹ -->
      <view class="product-desc-row">
        <text class="product-desc">{{product.description}}</text>
      </view>
    </view>

    <!-- æœåŠ¡ä¿éšœ -->
    <view class="service-section">
      <view class="service-item" wx:for="{{product.services}}" wx:key="index">
        <text class="service-icon">âœ“</text>
        <text class="service-text">{{item}}</text>
      </view>
    </view>

    <!-- è§„æ ¼é€‰æ‹©å…¥å£ -->
    <view class="spec-entry" bindtap="showSpecSelector">
      <view class="spec-label">
        <text class="label-text">è§„æ ¼</text>
      </view>
      <view class="spec-value">
        <text class="value-text">{{selectedSpecText}}</text>
        <text class="arrow-icon">â€º</text>
      </view>
    </view>

    <!-- å•†å“è¯¦æƒ… -->
    <view class="detail-section">
      <view class="section-header">
        <view class="header-line"></view>
        <text class="header-title">å•†å“è¯¦æƒ…</text>
        <view class="header-line"></view>
      </view>
      
      <view class="detail-content">
        <view class="detail-item" wx:for="{{product.details}}" wx:key="index">
          <text class="detail-text">{{item}}</text>
        </view>
      </view>

      <!-- æ¸©é¦¨æç¤º -->
      <view class="notice-box">
        <text class="notice-title">æ¸©é¦¨æç¤º</text>
        <text class="notice-item">â€¢ é‡å¤§å¯å’¨è¯¢åº—ä¸»è·å–ä¼˜æƒ ä»·æ ¼</text>
        <text class="notice-item">â€¢ 24å°æ—¶æœåŠ¡ï¼Œéšæ—¶å“åº”</text>
        <text class="notice-item">â€¢ æ”¯æŒå®å¤å…¨å¢ƒï¼Œå†…è’™ã€ç”˜è‚ƒéƒ¨åˆ†åœ°åŒºå…è´¹å¼€è½¦é…é€</text>
        <text class="notice-item">â€¢ å…¶ä»–åœ°åŒºè¯·å’¨è¯¢åº—ä¸»è·å–è¿è´¹æŠ¥ä»·ï¼Œé‡å¤§å¯äº«å…è¿è´¹</text>
      </view>
    </view>

    <!-- åº•éƒ¨å ä½ -->
    <view class="bottom-placeholder"></view>
  </scroll-view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar" wx:if="{{product}}">
    <view class="bar-left">
      <view class="bar-item" bindtap="contactService">
        <text class="bar-icon">ğŸ“</text>
        <text class="bar-text">å®¢æœ</text>
      </view>
      <view class="bar-item" bindtap="toggleFavorite">
        <text class="bar-icon">{{isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        <text class="bar-text">æ”¶è—</text>
      </view>
      <view class="bar-item" bindtap="shareProduct">
        <text class="bar-icon">ğŸ“¤</text>
        <text class="bar-text">åˆ†äº«</text>
      </view>
    </view>
    <view class="bar-right">
      <view class="btn-cart {{isAddingToCart ? 'disabled' : ''}}" bindtap="addToCart">åŠ å…¥è´­ç‰©è½¦</view>
      <view class="btn-buy" bindtap="buyNow">ç«‹å³ä¸‹å•</view>
    </view>
  </view>

  <!-- è§„æ ¼é€‰æ‹©å¼¹çª— -->
  <view class="spec-popup-mask {{showSpecPopup ? 'show' : ''}}" bindtap="hideSpecPopup"></view>
  <view class="spec-popup {{showSpecPopup ? 'show' : ''}}">
    <view class="popup-header">
      <image class="popup-image" src="{{product.images[0]}}" mode="aspectFill" />
      <view class="popup-info">
        <text class="popup-name">{{product.name}}</text>
        <!-- å¼¹çª—å†…ä»·æ ¼æ˜¾ç¤º -->
        <view class="popup-price-wrap">
          <view class="popup-price">
            <text class="popup-price-symbol">Â¥</text>
            <text class="popup-price-value">{{product.userPrice || product.basePrice}}</text>
          </view>
          <text wx:if="{{product.userPrice}}" class="popup-original-price">Â¥{{product.basePrice}}</text>
        </view>
        <text class="popup-stock">åº“å­˜: {{product.stock}} ä»¶</text>
      </view>
      <view class="popup-close" bindtap="hideSpecPopup">Ã—</view>
    </view>

    <scroll-view class="popup-body" scroll-y>
      <!-- è§„æ ¼é€‰é¡¹ -->
      <view class="spec-group" wx:for="{{product.specs}}" wx:key="id">
        <text class="spec-name">{{item.name}}</text>
        <view class="spec-values">
          <view 
            class="spec-value-item {{value.selected ? 'selected' : ''}}"
            wx:for="{{item.values}}"
            wx:for-item="value"
            wx:key="id"
            data-spec-id="{{item.id}}"
            data-value-id="{{value.id}}"
            bindtap="selectSpec"
          >
            <text>{{value.name}}</text>
          </view>
        </view>
      </view>

      <!-- æ•°é‡é€‰æ‹© -->
      <view class="quantity-row">
        <text class="quantity-label">è´­ä¹°æ•°é‡</text>
        <view class="quantity-control">
          <view class="qty-btn {{quantity <= 1 ? 'disabled' : ''}}" bindtap="decreaseQuantity">-</view>
          <input 
            class="qty-input" 
            type="number" 
            value="{{quantity}}" 
            bindinput="onQuantityInput"
          />
          <view class="qty-btn {{quantity >= product.stock ? 'disabled' : ''}}" bindtap="increaseQuantity">+</view>
        </view>
      </view>
    </scroll-view>

    <view class="popup-footer">
      <view class="popup-btn cart" bindtap="addToCart">åŠ å…¥è´­ç‰©è½¦</view>
      <view class="popup-btn buy" bindtap="buyNow">ç«‹å³ä¸‹å•</view>
    </view>
  </view>
</view>
