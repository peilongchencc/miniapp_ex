<!--product-detail.wxml-->
<navigation-bar
  title="商品详情"
  back="{{true}}"
  color="white"
  background="linear-gradient(135deg, rgba(130, 180, 170, 0.85) 0%, rgba(100, 160, 150, 0.95) 100%)"
  bindback="goBack"
/>

<scroll-view class="scrollarea" scroll-y type="list" enhanced show-scrollbar="{{false}}" wx:if="{{product}}">
    <!-- 商品图片轮播 -->
    <view class="swiper-section">
      <swiper 
        class="product-swiper"
        indicator-dots="{{false}}"
        autoplay="{{true}}"
        interval="{{4000}}"
        circular="{{true}}"
        bindchange="onSwiperChange"
      >
        <swiper-item wx:for="{{product.images}}" wx:key="index">
          <image 
            class="swiper-image" 
            src="{{item}}" 
            mode="aspectFill"
            data-index="{{index}}"
            bindtap="previewImage"
          />
        </swiper-item>
      </swiper>
      <view class="swiper-indicator">
        <text class="indicator-text">{{currentImageIndex + 1}}/{{product.images.length}}</text>
      </view>
    </view>

    <!-- 商品基本信息 -->
    <view class="product-info-section">
      <!-- 价格区域：微信询价 -->
      <view class="price-row">
        <view class="price-area">
          <text class="inquiry-price clickable" bindtap="onInquiryTap">微信询价</text>
        </view>
        <view class="sold-info">
          <text class="sold-text">已售 {{product.soldCount}} 件</text>
        </view>
      </view>
      
      <!-- 商品名称 -->
      <view class="product-name-row">
        <text class="product-name">{{product.name}}</text>
      </view>
      
      <!-- 商品简介 -->
      <view class="product-desc-row">
        <text class="product-desc">{{product.description}}</text>
      </view>
    </view>

    <!-- 服务保障 -->
    <view class="service-section">
      <view class="service-item" wx:for="{{product.services}}" wx:key="index">
        <text class="service-icon">✓</text>
        <text class="service-text">{{item}}</text>
      </view>
    </view>

    <!-- 规格选择入口 -->
    <view class="spec-entry" bindtap="showSpecSelector">
      <view class="spec-label">
        <text class="label-text">规格</text>
      </view>
      <view class="spec-value">
        <text class="value-text">{{selectedSpecText}}</text>
        <text class="arrow-icon">›</text>
      </view>
    </view>

    <!-- 商品详情 -->
    <view class="detail-section">
      <view class="section-header">
        <view class="header-line"></view>
        <text class="header-title">商品详情</text>
        <view class="header-line"></view>
      </view>
      
      <view class="detail-content">
        <view class="detail-item" wx:for="{{product.details}}" wx:key="index">
          <text class="detail-text">{{item}}</text>
        </view>
      </view>

      <!-- 温馨提示 -->
      <view class="notice-box">
        <text class="notice-title">温馨提示</text>
        <text class="notice-item">• 量大可咨询店主获取优惠价格</text>
        <text class="notice-item">• 24小时服务，随时响应</text>
        <text class="notice-item">• 支持宁夏全境，内蒙、甘肃部分地区免费开车配送</text>
        <text class="notice-item">• 其他地区请咨询店主获取运费报价，量大可享免运费</text>
      </view>
    </view>

  <!-- 底部占位 -->
  <view class="bottom-placeholder"></view>
</scroll-view>

<!-- 底部操作栏 -->
<view class="bottom-bar" wx:if="{{product}}">
    <view class="bar-left">
      <view class="bar-item" bindtap="contactService">
        <text class="bar-icon">📞</text>
        <text class="bar-text">客服</text>
      </view>
      <view class="bar-item" bindtap="toggleFavorite">
        <text class="bar-icon">{{isFavorite ? '❤️' : '🤍'}}</text>
        <text class="bar-text">收藏</text>
      </view>
      <view class="bar-item" bindtap="shareProduct">
        <text class="bar-icon">📤</text>
        <text class="bar-text">分享</text>
      </view>
    </view>
    <view class="bar-right">
      <view class="btn-cart {{isAddingToCart ? 'disabled' : ''}}" bindtap="addToCart">加入购物车</view>
      <view class="btn-buy" bindtap="buyNow">立即下单</view>
    </view>
</view>

<!-- 微信联系弹窗组件 -->
<wechat-modal 
  visible="{{showWechatModal}}" 
  wechat-id="{{contact.wechat}}"
  qrcode="{{contact.wechatQrcode}}"
  bind:close="onCloseWechatModal"
/>
<!-- 规格选择弹窗 -->
<view class="spec-popup-mask {{showSpecPopup ? 'show' : ''}}" bindtap="hideSpecPopup"></view>
<view class="spec-popup {{showSpecPopup ? 'show' : ''}}">
    <view class="popup-header">
      <image class="popup-image" src="{{product.images[0]}}" mode="aspectFill" />
      <view class="popup-info">
        <text class="popup-name">{{product.name}}</text>
        <!-- 弹窗内价格显示 -->
        <view class="popup-price-wrap">
          <text class="popup-inquiry-price">微信询价</text>
        </view>
        <text class="popup-stock">库存: {{product.stock}} 件</text>
      </view>
      <view class="popup-close" bindtap="hideSpecPopup">×</view>
    </view>

    <scroll-view class="popup-body" scroll-y>
      <!-- 规格选项 -->
      <view class="spec-group" wx:for="{{product.specs}}" wx:key="id">
        <text class="spec-name">{{item.name}}</text>
        <view class="spec-values">
          <view 
            class="spec-value-item {{value.selected ? 'selected' : ''}}"
            wx:for="{{item.values}}"
            wx:for-item="value"
            wx:key="id"
            data-spec-id="{{item.id}}"
            data-value-id="{{value.id}}"
            bindtap="selectSpec"
          >
            <text>{{value.name}}</text>
          </view>
        </view>
      </view>

      <!-- 数量选择 -->
      <view class="quantity-row">
        <text class="quantity-label">购买数量</text>
        <view class="quantity-control">
          <view class="qty-btn {{quantity <= 1 ? 'disabled' : ''}}" bindtap="decreaseQuantity">-</view>
          <input 
            class="qty-input" 
            type="number" 
            value="{{quantity}}" 
            bindinput="onQuantityInput"
          />
          <view class="qty-btn {{quantity >= product.stock ? 'disabled' : ''}}" bindtap="increaseQuantity">+</view>
        </view>
      </view>
    </scroll-view>

    <view class="popup-footer">
      <view class="popup-btn cart" bindtap="addToCart">加入购物车</view>
      <view class="popup-btn buy" bindtap="buyNow">立即下单</view>
  </view>
</view>
